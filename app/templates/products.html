<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Products - Acme Importer</title>
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .htmx-request { opacity: 0.6; }
    tr.htmx-request { background: #f3f4f6; }
  </style>
</head>
<body class="bg-gray-100 min-h-screen">
  <div class="max-w-7xl mx-auto p-6">
    <div class="bg-white rounded-xl shadow-lg p-8">
      <div class="flex justify-between items-center mb-8">
        <h1 class="text-3xl font-bold text-gray-800">Products ({{ products|length }} shown)</h1>
        <div class="space-x-4">
          <a href="/" class="bg-gray-600 text-white px-5 py-2 rounded hover:bg-gray-700">← Back to Upload</a>
          <button hx-post="/products/bulk-delete"
                  hx-confirm="Are you sure you want to DELETE ALL products? This cannot be undone!"
                  hx-target="body"
                  class="bg-red-600 text-white px-5 py-2 rounded hover:bg-red-700">
            Delete All Products
          </button>
        </div>
      </div>

      <!-- Search & Filters -->
      <div class="mb-6 flex gap-4">
        <input type="text" placeholder="Search SKU or Name..."
               hx-get="/products"
               hx-trigger="keyup changed delay:300ms"
               name="q"
               class="px-4 py-2 border rounded-lg w-96">
        <select hx-get="/products" hx-trigger="change" name="active" class="px-4 py-2 border rounded-lg">
          <option value="">All Status</option>
          <option value="true">Active Only</option>
          <option value="false">Inactive Only</option>
        </select>
      </div>

      <!-- Products Table -->
      <div class="overflow-x-auto">
        <table class="w-full table-auto border-collapse">
          <thead>
            <tr class="bg-gray-800 text-white">
              <th class="px-4 py-3 text-left">SKU</th>
              <th class="px-4 py-3 text-left">Name</th>
              <th class="px-4 py-3 text-left">Price</th>
              <th class="px-4 py-3 text-left">Status</th>
              <th class="px-4 py-3 text-center">Actions</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200">
            {% for p in products %}
            <tr>
              <td class="px-4 py-4 font-mono text-sm">{{ p.sku }}</td>
              <td class="px-4 py-4 max-w-md truncate" title="{{ p.name }}">{{ p.name }}</td>
              <td class="px-4 py-4">${{ "%.2f"|format(p.price) }}</td>
              <td class="px-4 py-4">
                <span class="px-3 py-1 rounded-full text-xs font-medium {% if p.active %}bg-green-100 text-green-800{% else %}bg-gray-100 text-gray-800{% endif %}">
                  {{ "Active" if p.active else "Inactive" }}
                </span>
              </td>
              <td class="px-4 py-4 text-center space-x-3">
                <button onclick="editProduct('{{ p.id }}')"
                        class="text-blue-600 hover:underline text-sm">Edit</button>
                <button hx-delete="/products/{{ p.id }}"
                        hx-confirm="Delete product {{ p.sku }}?"
                        hx-target="closest tr"
                        hx-swap="outerHTML"
                        class="text-red-600 hover:underline text-sm">Delete</button>
              </td>
            </tr>
            {% else %}
            <tr>
              <td colspan="5" class="text-center py-12 text-gray-500">
                No products found. Upload a CSV to get started!
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Pagination (simple) -->
      <div class="mt-6 text-center">
        <span class="text-sm text-gray-600">Showing first 100 • More coming soon</span>
      </div>
    </div>
  </div>

  <!-- Edit Modal -->
  <div id="editModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50">
    <div class="bg-white rounded-xl p-8 max-w-lg w-full">
      <h2 class="text-2xl font-bold mb-6">Edit Product</h2>
      <form hx-put="/products/0" hx-target="#editModal" hx-swap="outerHTML">
        <input type="hidden" name="id" id="editId"/>
        <div class="space-y-4">
          <div>
            <label class="block font-medium">SKU</label>
            <input type="text" name="sku" id="editSku" class="w-full border rounded px-3 py-2" required/>
          </div>
          <div>
            <label class="block font-medium">Name</label>
            <input type="text" name="name" id="editName" class="w-full border rounded px-3 py-2" required/>
          </div>
          <div>
            <label class="block font-medium">Price</label>
            <input type="number" step="0.01" name="price" id="editPrice" class="w-full border rounded px-3 py-2"/>
          </div>
          <div>
            <label class="inline-flex items-center">
              <input type="checkbox" name="active" id="editActive" class="mr-2"/>
              <span>Active</span>
            </label>
          </div>
        </div>
        <div class="mt-8 flex justify-end space-x-4">
          <button type="button" onclick="document.getElementById('editModal').classList.add('hidden')"
                  class="px-5 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">Cancel</button>
          <button type="submit" class="px-5 py-2 bg-blue-600 text-white rounded hover:bg-blue-700">Save</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    function editProduct(id) {
      // In a real app you'd fetch the product, but for demo we just open modal
      document.getElementById('editModal').classList.remove('hidden');
      // You can pre-fill via JS or better: use hx-get to load a form
    }
  </script>
</body>
</html>